<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' 'unsafe-inline' 'unsafe-eval'; script-src 'self' 'unsafe-inline' 'unsafe-eval'">
    <title>Data Loader Tests</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .test-section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .test-button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        .test-button:hover {
            background-color: #45a049;
        }

        .result-area {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }

        .error {
            color: #dc3545;
            background-color: #f8d7da;
        }

        .success {
            color: #28a745;
            background-color: #d4edda;
        }
    </style>
</head>

<body>
    <!-- Race Loader Tests -->
    <div class="test-section">
        <h2>Race Loader Tests</h2>
        <div>
            <button class="test-button" onclick="testRace('loadRaces')">Load All Races</button>
            <button class="test-button" onclick="testRace('getRaceById', 'dwarf_phb')">Get Dwarf</button>
            <button class="test-button" onclick="testRace('getSubraces', 'elf_phb')">Get Elf Subraces</button>
            <button class="test-button" onclick="testRace('getRaceFluff', 'Dwarf', 'PHB')">Get Dwarf Fluff</button>
        </div>
        <div id="race-result" class="result-area"></div>
    </div>

    <!-- Class Loader Tests -->
    <div class="test-section">
        <h2>Class Loader Tests</h2>
        <div>
            <button class="test-button" onclick="testClass('loadClasses')">Load All Classes</button>
            <button class="test-button" onclick="testClass('getClassById', 'fighter_phb')">Get Fighter</button>
            <button class="test-button" onclick="testClass('getSubclasses', 'fighter_phb')">Get Fighter
                Subclasses</button>
            <button class="test-button" onclick="testClass('getClassFluff', 'Fighter', 'PHB')">Get Fighter
                Fluff</button>
        </div>
        <div id="class-result" class="result-area"></div>
    </div>

    <!-- Background Loader Tests -->
    <div class="test-section">
        <h2>Background Loader Tests</h2>
        <div>
            <button class="test-button" onclick="testBackground('loadBackgrounds')">Load All Backgrounds</button>
            <button class="test-button" onclick="testBackground('getBackgroundById', 'acolyte_phb')">Get
                Acolyte</button>
            <button class="test-button" onclick="testBackground('getBackgroundFluff', 'Acolyte', 'PHB')">Get Acolyte
                Fluff</button>
        </div>
        <div id="background-result" class="result-area"></div>
    </div>

    <!-- Item Loader Tests -->
    <div class="test-section">
        <h2>Item Loader Tests</h2>
        <div>
            <button class="test-button" onclick="testItem('loadItems')">Load All Items</button>
            <button class="test-button" onclick="testItem('getItemById', 'beadofrefreshment_xge')">Get Bead of
                Refreshment</button>
            <button class="test-button" onclick="testItem('getBaseItem', 'Longsword')">Get Base Longsword</button>
            <button class="test-button" onclick="testItem('getMagicVariant', 'Flame Tongue')">Get Flame Tongue</button>
            <button class="test-button" onclick="testItem('getItemFluff', 'Armor of the Valiant Soul', 'TDCSR')">Get
                Armor Fluff</button>
        </div>
        <div id="item-result" class="result-area"></div>
    </div>

    <!-- Deity Loader Tests -->
    <div class="test-section">
        <h2>Deity Loader Tests</h2>
        <div>
            <button class="test-button" onclick="testDeity('loadDeities')">Load All Deities</button>
            <button class="test-button" onclick="testDeity('getDeityById', 'tyr_scag')">Get Tyr</button>
        </div>
        <div id="deity-result" class="result-area"></div>
    </div>

    <!-- Feature Loader Tests -->
    <div class="test-section">
        <h2>Feature Loader Tests</h2>
        <div>
            <button class="test-button" onclick="testFeature('loadFeatures')">Load All Features</button>
            <button class="test-button" onclick="testFeature('getFeatById', 'alert_phb')">Get Alert Feat</button>
            <button class="test-button" onclick="testFeature('getOptionalFeatureById', 'eldritchblast_phb')">Get
                Eldritch Blast</button>
            <button class="test-button" onclick="testFeature('getFeatFluff', 'Alert', 'PHB')">Get Alert Fluff</button>
        </div>
        <div id="feature-result" class="result-area"></div>
    </div>

    <!-- Spell Loader Tests -->
    <div class="test-section">
        <h2>Spell Loader Tests</h2>
        <div>
            <button class="test-button" onclick="testSpell('loadSpells')">Load All Spells</button>
            <button class="test-button" onclick="testSpell('getSpellById', 'fireball_phb')">Get Fireball</button>
            <button class="test-button" onclick="testSpell('getSpellFluff', 'Fireball', 'PHB')">Get Fireball
                Fluff</button>
        </div>
        <div id="spell-result" class="result-area"></div>
    </div>

    <script type="module">
        import { RaceLoader } from './js/dataloaders/RaceLoader.js';
        import { ClassLoader } from './js/dataloaders/ClassLoader.js';
        import { BackgroundLoader } from './js/dataloaders/BackgroundLoader.js';
        import { ItemLoader } from './js/dataloaders/ItemLoader.js';
        import { DeityLoader } from './js/dataloaders/DeityLoader.js';
        import { FeatureLoader } from './js/dataloaders/FeatureLoader.js';
        import { SpellLoader } from './js/dataloaders/SpellLoader.js';

        const raceResultArea = document.getElementById('race-result');
        const classResultArea = document.getElementById('class-result');
        const backgroundResultArea = document.getElementById('background-result');
        const itemResultArea = document.getElementById('item-result');
        const deityResultArea = document.getElementById('deity-result');
        const featureResultArea = document.getElementById('feature-result');
        const spellResultArea = document.getElementById('spell-result');

        const raceLoader = new RaceLoader();
        const classLoader = new ClassLoader();
        const backgroundLoader = new BackgroundLoader();
        const itemLoader = new ItemLoader();
        const deityLoader = new DeityLoader();
        const featureLoader = new FeatureLoader();
        const spellLoader = new SpellLoader();

        // Generic test function creator
        function createTestFunction(loader, resultArea, name) {
            return async function (method, ...args) {
                resultArea.innerHTML = 'Loading...';
                resultArea.className = 'result-area';

                try {
                    const result = await loader[method](...args);
                    resultArea.textContent = JSON.stringify(result, null, 2);
                    resultArea.classList.add('success');
                    console.log(`${name} ${method} result:`, result);
                } catch (error) {
                    resultArea.textContent = `Error: ${error.message}\n${error.stack}`;
                    resultArea.classList.add('error');
                    console.error(`${name} test error:`, error);
                }
            };
        }

        // Create test functions for each loader
        window.testRace = createTestFunction(raceLoader, raceResultArea, 'RaceLoader');
        window.testClass = createTestFunction(classLoader, classResultArea, 'ClassLoader');
        window.testBackground = createTestFunction(backgroundLoader, backgroundResultArea, 'BackgroundLoader');
        window.testItem = createTestFunction(itemLoader, itemResultArea, 'ItemLoader');
        window.testDeity = createTestFunction(deityLoader, deityResultArea, 'DeityLoader');
        window.testFeature = createTestFunction(featureLoader, featureResultArea, 'FeatureLoader');
        window.testSpell = createTestFunction(spellLoader, spellResultArea, 'SpellLoader');

        // Initial load test
        Promise.all([
            raceLoader.loadRaces(),
            classLoader.loadClasses(),
            backgroundLoader.loadBackgrounds(),
            itemLoader.loadItems(),
            deityLoader.loadDeities(),
            featureLoader.loadFeatures(),
            spellLoader.loadSpells()
        ]).then(() => {
            console.log('Initial data load complete');
        }).catch(error => {
            console.error('Initial load error:', error);
        });
    </script>
</body>

</html>