
Running 2 tests using 1 worker

[1A[2K[1/2] tests\level-up-save-button.spec.js:14:3 Ã”Ã‡â•‘ Level Up Save Button Ã”Ã‡â•‘ should enable save button and persist changes after level-up
[1A[2Ktests\level-up-save-button.spec.js:14:3 Ã”Ã‡â•‘ Level Up Save Button Ã”Ã‡â•‘ should enable save button and persist changes after level-up

=== Testing Level Up Save Button: "LevelUpSaveTest-1768533816529" ===


[1A[2K1. Launching app...


[1A[2K(node:19660) [DEP0190] DeprecationWarning: Passing args to a child process with shell option true can lead to security vulnerabilities, as the arguments are not escaped, only concatenated.
(Use `node --trace-deprecation ...` to show where the warning was created)
[1A[2K2. Waiting for app to load...

[1A[2K[info] AppState State initialized {isLoading: false, currentPage: home, currentCharacter: null, characters: Array(0), hasUnsavedChanges: false}

[1A[2K[info] [Router] Router initialized

[1A[2K[info] PageLoader PageLoader initialized

[1A[2K[info] [Router] Registering route {path: home, config: Object}

[1A[2K[info] [Router] Registering route {path: build, config: Object}

[1A[2K[info] [Router] Registering route {path: equipment, config: Object}

[1A[2K[info] [Router] Registering route {path: spells, config: Object}

[1A[2K[info] [Router] Registering route {path: details, config: Object}

[1A[2K[info] [Router] Registering route {path: settings, config: Object}

[1A[2K[info] [Router] Registering route {path: preview, config: Object}

[1A[2K[info] [Router] All routes registered {routes: Array(7)}

[1A[2K[info] NavigationController Controller created

[1A[2K[debug] [EventBus] Listener registered {event: character:selected, totalListeners: 1}

[1A[2K[debug] [EventBus] Listener registered {event: character:loaded, totalListeners: 1}

[1A[2K[debug] [EventBus] Listener registered {event: character:created, totalListeners: 1}

[1A[2K[debug] [EventBus] Listener registered {event: character:selected, totalListeners: 2}

[1A[2K[log] [ThemeManager] Applied theme: dark

[1A[2K[debug] [EventBus] Listener registered {event: PAGE_CHANGED, totalListeners: 1}

[1A[2K[log] [ThemeManager] Initialized with theme: dark

[1A[2K[info] AppInitializer Using configured data source: local

[1A[2K[info] AppInitializer Auto update disabled; skipping data sync

[1A[2K[info] [ClassService] Initializing class data

[1A[2K[info] [RaceService] Initializing race data

[1A[2K[info] [BackgroundService] Initializing background data

[1A[2K[info] [ConditionService] Initializing condition data

[1A[2K[info] [MonsterService] Initializing monster data

[1A[2K[info] [FeatService] Initializing feat data

[1A[2K[info] [SkillService] Initializing skill data

[1A[2K[info] [VariantRuleService] Initializing variant rule data

[1A[2K[info] [OptionalFeatureService] Initializing optional feature data

[1A[2K[info] [ConditionService] Conditions loaded successfully {count: 30}

[1A[2K[info] [FeatService] Feats loaded successfully {count: 272}

[1A[2K[info] [SkillService] Skills loaded successfully {count: 36}

[1A[2K[debug] [EventBus] Event emitted {event: items:loaded, argsCount: 2542}

[1A[2K[info] [BackgroundService] Backgrounds loaded and normalized {count: 182}

[1A[2K[info] AppState Setting loaded data: backgrounds

[1A[2K[debug] AppState setState called {loadedData: Object}

[1A[2K[debug] [EventBus] Event emitted {event: state:changed, argsCount: 2}

[1A[2K[debug] [EventBus] Event emitted {event: state:loadedData:changed, argsCount: 2}

[1A[2K[debug] AppState Emitted: state:loadedData:changed

[1A[2K[info] AppState State updated {updates: Object}

[1A[2K[debug] [EventBus] Event emitted {event: data:loaded, argsCount: 2}

[1A[2K[debug] [EventBus] Event emitted {event: data:loaded, argsCount: 2}

[1A[2K[info] AppState Setting loaded data: actions

[1A[2K[debug] AppState setState called {loadedData: Object}

[1A[2K[debug] [EventBus] Event emitted {event: state:changed, argsCount: 2}

[1A[2K[debug] [EventBus] Event emitted {event: state:loadedData:changed, argsCount: 2}

[1A[2K[debug] AppState Emitted: state:loadedData:changed

[1A[2K[info] AppState State updated {updates: Object}

[1A[2K[debug] [EventBus] Event emitted {event: data:loaded, argsCount: 2}

[1A[2K[info] [VariantRuleService] Variant rules loaded successfully {count: 239}

[1A[2K[debug] [EventBus] Event emitted {event: spells:loaded, argsCount: 938}

[1A[2K[info] [MonsterService] Monsters loaded successfully {count: 4493}

[1A[2K[info] AppState Setting loaded data: classes

[1A[2K[debug] AppState setState called {loadedData: Object}

[1A[2K[debug] [EventBus] Event emitted {event: state:changed, argsCount: 2}

[1A[2K[debug] [EventBus] Event emitted {event: state:loadedData:changed, argsCount: 2}

[1A[2K[debug] AppState Emitted: state:loadedData:changed

[1A[2K[info] AppState State updated {updates: Object}

[1A[2K[debug] [EventBus] Event emitted {event: data:loaded, argsCount: 2}

[1A[2K[info] [ClassService] Class data loaded {classes: 30, classFeatures: 677, subclasses: 329, subclassFeatures: 1480, fromCache: false}

[1A[2K[info] AppState Setting loaded data: races

[1A[2K[debug] AppState setState called {loadedData: Object}

[1A[2K[debug] [EventBus] Event emitted {event: state:changed, argsCount: 2}

[1A[2K[debug] [EventBus] Event emitted {event: state:loadedData:changed, argsCount: 2}

[1A[2K[debug] AppState Emitted: state:loadedData:changed

[1A[2K[info] AppState State updated {updates: Object}

[1A[2K[debug] [EventBus] Event emitted {event: data:loaded, argsCount: 2}

[1A[2K[debug] [RaceService] Building race index

[1A[2K[info] [RaceService] Human (PHB) subraces: {explicit: Array(8), all: Array(7), baseSubrace: undefined}

[1A[2K[info] [RaceService] Human (XPHB) subraces: {explicit: Array(0), all: Array(0), baseSubrace: undefined}

[1A[2K[debug] [RaceService] Indexed 158 races

[1A[2K[info] [RaceService] Races loaded successfully {count: 158, fromCache: false}

[1A[2K[info] AppInitializer Initializing core components with NEW architecture

[1A[2K[info] TooltipSystem Initializing event listeners

[1A[2K[info] AppInitializer Ã”Â£Ã´ text processor initialized

[1A[2K[debug] [EventBus] Listener registered {event: character:selected, totalListeners: 3}

[1A[2K[debug] [EventBus] Listener registered {event: character:updated, totalListeners: 1}

[1A[2K[debug] [EventBus] Listener registered {event: character:saved, totalListeners: 1}

[1A[2K[debug] [EventBus] Listener registered {event: page:changed, totalListeners: 1}

[1A[2K[debug] [EventBus] Listener registered {event: state:hasUnsavedChanges:changed, totalListeners: 1}

[1A[2K[debug] AppState Get: currentCharacter null

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[debug] AppState Get: currentCharacter null

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[log] [TitlebarController] updateActionButtons called

[1A[2K[log] [TitlebarController] Character: {exists: false, name: undefined, hasProgression: false, progressionClasses: undefined, classesLength: undefined}

[1A[2K[log] [TitlebarController] Level Up Button: {hasClasses: undefined, disabled: true, characterExists: false}

[1A[2K[log] [TitlebarController] Initialized

[1A[2K[info] AppInitializer Ã”Â£Ã´ titlebar controller initialized

[1A[2K[debug] [EventBus] Listener registered {event: page:loaded, totalListeners: 1}

[1A[2K[info] PageHandler Initialized successfully

[1A[2K[info] AppInitializer Ã”Â£Ã´ page handler initialized

[1A[2K[info] NavigationController Initializing

[1A[2K[info] PageLoader Initialized with content area {contentAreaId: pageContent}

[1A[2K[debug] [EventBus] Listener registered {event: page:changed, totalListeners: 2}

[1A[2K[debug] [EventBus] Listener registered {event: page:loaded, totalListeners: 2}

[1A[2K[debug] [EventBus] Listener registered {event: character:selected, totalListeners: 4}

[1A[2K[debug] [EventBus] Listener registered {event: character:created, totalListeners: 2}

[1A[2K[debug] [EventBus] Listener registered {event: character:deleted, totalListeners: 1}

[1A[2K[debug] NavigationController Event listeners setup

[1A[2K[debug] NavigationController Cached navigation buttons {count: 6}

[1A[2K[debug] NavigationController Cached build section buttons {count: 7}

[1A[2K[debug] NavigationController Navigation buttons setup

[1A[2K[debug] NavigationController Navigation state updated {hasCharacter: false}

[1A[2K[info] NavigationController [2026-01-16T03:23:37.238Z] Navigate to page: "home"

[1A[2K[info] [Router] Navigating to {path: home}

[1A[2K[info] AppState Setting current page: home

[1A[2K[debug] AppState setState called {currentPage: home}

[1A[2K[debug] [EventBus] Event emitted {event: state:changed, argsCount: 2}

[1A[2K[info] AppState State updated {updates: Object}

[1A[2K[debug] [EventBus] Event emitted {event: page:changed, argsCount: 1}

[1A[2K[debug] AppState Get: currentCharacter null

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[log] [TitlebarController] updateActionButtons called

[1A[2K[log] [TitlebarController] Character: {exists: false, name: undefined, hasProgression: false, progressionClasses: undefined, classesLength: undefined}

[1A[2K[log] [TitlebarController] Level Up Button: {hasClasses: undefined, disabled: true, characterExists: false}

[1A[2K[debug] NavigationController Handling page change {page: home}

[1A[2K[debug] [EventBus] Event emitted {event: page:changed, argsCount: 1}

[1A[2K[debug] AppState Get: currentCharacter null

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[log] [TitlebarController] updateActionButtons called

[1A[2K[log] [TitlebarController] Character: {exists: false, name: undefined, hasProgression: false, progressionClasses: undefined, classesLength: undefined}

[1A[2K[log] [TitlebarController] Level Up Button: {hasClasses: undefined, disabled: true, characterExists: false}

[1A[2K[debug] NavigationController Handling page change {page: home}

[1A[2K[info] [Router] Navigation successful {path: home}

[1A[2K[info] NavigationController Initialized successfully

[1A[2K[debug] NavigationController Set data-current-page attribute to "home" {page: home, attributeValue: home}

[1A[2K[debug] NavigationController [2026-01-16T03:23:37.239Z] Starting loadAndRenderPage: home

[1A[2K[info] PageLoader Load and render {templateName: home.html}

[1A[2K[debug] PageLoader Loading page {templateName: home.html}

[1A[2K[info] AppInitializer Ã”Â£Ã´ navigation controller initialized

[1A[2K[info] SettingsService Initializing settings manager

[1A[2K[debug] [EventBus] Event emitted {event: service:initialized, argsCount: 2}

[1A[2K[info] SettingsService Settings manager initialized successfully

[1A[2K[info] AppInitializer Ã”Â£Ã´ settings service initialized

[1A[2K[info] AppInitializer Ã”Â£Ã´ notification center initialized

[1A[2K[info] AppInitializer Core components initialized {success: true, loaded: 6, errors: 0}

[1A[2K[info] AppInitializer Setting up UI event handlers

[1A[2K[debug] [EventBus] Listener registered {event: character:updated, totalListeners: 2}

[1A[2K[debug] [EventBus] Listener registered {event: character:saved, totalListeners: 2}

[1A[2K[debug] [EventBus] Listener registered {event: character:selected, totalListeners: 5}

[1A[2K[debug] [EventBus] Listener registered {event: page:changed, totalListeners: 3}

[1A[2K[debug] [EventBus] Listener registered {event: state:hasUnsavedChanges:changed, totalListeners: 2}

[1A[2K[info] AppInitializer UI event handlers set up successfully

[1A[2K[info] AppInitializer Initialization complete

[1A[2K[info] PageLoader Page loaded and cached {templateName: home.html}

[1A[2K[debug] PageLoader Page rendered successfully

[1A[2K[info] NavigationController [2026-01-16T03:23:37.314Z] Page rendered successfully: home {template: home.html, pageName: home}

[1A[2K[debug] NavigationController Page render complete: home

[1A[2K[debug] NavigationController Emitting PAGE_LOADED event for page: "home"

[1A[2K[debug] [EventBus] Event emitted {event: page:loaded, argsCount: 1}

[1A[2K[info] PageHandler Handling page loaded {pageName: home}

[1A[2K[info] PageHandler Initializing home page

[1A[2K[info] CharacterManager Loading character list

[1A[2K[debug] NavigationController Nav buttons updated {activePage: home}

[1A[2K[debug] NavigationController Emitting PAGE_CHANGED event for page: "home"

[1A[2K[debug] [EventBus] Event emitted {event: page:changed, argsCount: 1}

[1A[2K[debug] AppState Get: currentCharacter null

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[log] [TitlebarController] updateActionButtons called

[1A[2K[log] [TitlebarController] Character: {exists: false, name: undefined, hasProgression: false, progressionClasses: undefined, classesLength: undefined}

[1A[2K[log] [TitlebarController] Level Up Button: {hasClasses: undefined, disabled: true, characterExists: false}

[1A[2K[debug] NavigationController Handling page change {page: home}

[1A[2K[debug] AppInitializer [2026-01-16T03:23:37.317Z] EVENT: PAGE_CHANGED to "home"

[1A[2K[debug] AppInitializer Temporary suppression enabled until 2026-01-16T03:23:37.467Z

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[debug] AppInitializer Unsaved indicator updated: show=false {hasUnsaved: false, currentPage: home}

[1A[2K[info] AppState Setting characters list {count: 2}

[1A[2K[debug] AppState setState called {characters: Array(2)}

[1A[2K[debug] [EventBus] Event emitted {event: state:changed, argsCount: 2}

[1A[2K[debug] [EventBus] Event emitted {event: state:characters:changed, argsCount: 2}

[1A[2K[debug] AppState Emitted: state:characters:changed

[1A[2K[info] AppState State updated {updates: Object}

[1A[2K[info] CharacterManager Character list loaded {count: 2}

[1A[2K[info] PageHandler Character list rendered {count: 2}

[1A[2K[debug] [EventBus] Listener registered {event: character:selected, totalListeners: 6}

[1A[2K[debug] [EventBus] Listener registered {event: character:created, totalListeners: 3}

[1A[2K3. Clicking first character card...

[1A[2K   Initial character level: 1

[1A[2K[debug] PageHandler [2026-01-16T03:23:39.388Z] Character card clicked: 8fa32a00-e0f9-49d0-b33c-1acddc57cd45

[1A[2K[info] CharacterManager [2026-01-16T03:23:39.388Z] Loading character with ID: 8fa32a00-e0f9-49d0-b33c-1acddc57cd45

[1A[2K[debug] CharacterSchema Validation passed {characterId: 8fa32a00-e0f9-49d0-b33c-1acddc57cd45}

[1A[2K[log] [CharacterManager] Loading character - optionalProficiencies.tools.class: {"allowed":0,"options":[],"selected":[]}

[1A[2K[debug] CharacterManager Setting current character to: adfasdfasdfa (8fa32a00-e0f9-49d0-b33c-1acddc57cd45)

[1A[2K[info] AppState Setting current character {id: 8fa32a00-e0f9-49d0-b33c-1acddc57cd45, skipEvent: undefined}

[1A[2K[debug] AppState setState called {currentCharacter: Character}

[1A[2K[debug] [EventBus] Event emitted {event: state:changed, argsCount: 2}

[1A[2K[debug] [EventBus] Event emitted {event: state:currentCharacter:changed, argsCount: 2}

[1A[2K[debug] AppState Emitted: state:currentCharacter:changed

[1A[2K[info] AppState State updated {updates: Object}

[1A[2K[debug] [EventBus] Event emitted {event: character:selected, argsCount: 1}

[1A[2K[debug] [EventBus] Event emitted {event: sources:allowed-changed, argsCount: 1}

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[log] [TitlebarController] updateActionButtons called

[1A[2K[log] [TitlebarController] Character: {exists: true, name: adfasdfasdfa, hasProgression: true, progressionClasses: Array(1), classesLength: 1}

[1A[2K[log] [TitlebarController] Level Up Button: {hasClasses: true, disabled: false, characterExists: true}

[1A[2K[debug] NavigationController Navigation state updated {hasCharacter: true}

[1A[2K[debug] AppInitializer [2026-01-16T03:23:39.398Z] EVENT: CHARACTER_SELECTED received

[1A[2K[debug] AppInitializer Temporary suppression enabled until 2026-01-16T03:23:39.548Z

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[debug] AppInitializer Unsaved indicator updated: show=false {hasUnsaved: false, currentPage: home}

[1A[2K[info] CharacterManager Loading character list

[1A[2K[debug] CharacterManager Emitting CHARACTER_SELECTED event for character: adfasdfasdfa

[1A[2K[debug] [EventBus] Event emitted {event: character:selected, argsCount: 1}

[1A[2K[debug] [EventBus] Event emitted {event: sources:allowed-changed, argsCount: 1}

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[log] [TitlebarController] updateActionButtons called

[1A[2K[log] [TitlebarController] Character: {exists: true, name: adfasdfasdfa, hasProgression: true, progressionClasses: Array(1), classesLength: 1}

[1A[2K[log] [TitlebarController] Level Up Button: {hasClasses: true, disabled: false, characterExists: true}

[1A[2K[debug] NavigationController Navigation state updated {hasCharacter: true}

[1A[2K[debug] AppInitializer [2026-01-16T03:23:39.399Z] EVENT: CHARACTER_SELECTED received

[1A[2K[debug] AppInitializer Temporary suppression enabled until 2026-01-16T03:23:39.549Z

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[debug] AppInitializer Unsaved indicator updated: show=false {hasUnsaved: false, currentPage: home}

[1A[2K[info] CharacterManager Loading character list

[1A[2K[info] CharacterManager Ã”Â£Ã´ Character loaded successfully: adfasdfasdfa {id: 8fa32a00-e0f9-49d0-b33c-1acddc57cd45}

[1A[2K[info] PageHandler Ã”Â£Ã´ Character loaded from card: 8fa32a00-e0f9-49d0-b33c-1acddc57cd45 {character: adfasdfasdfa}

[1A[2K[info] AppState Setting characters list {count: 2}

[1A[2K[debug] AppState setState called {characters: Array(2)}

[1A[2K[debug] [EventBus] Event emitted {event: state:changed, argsCount: 2}

[1A[2K[debug] [EventBus] Event emitted {event: state:characters:changed, argsCount: 2}

[1A[2K[debug] AppState Emitted: state:characters:changed

[1A[2K[info] AppState State updated {updates: Object}

[1A[2K[info] CharacterManager Character list loaded {count: 2}

[1A[2K[info] PageHandler Character list rendered {count: 2}

[1A[2K[info] AppState Setting characters list {count: 2}

[1A[2K[debug] AppState setState called {characters: Array(2)}

[1A[2K[debug] [EventBus] Event emitted {event: state:changed, argsCount: 2}

[1A[2K[debug] [EventBus] Event emitted {event: state:characters:changed, argsCount: 2}

[1A[2K[debug] AppState Emitted: state:characters:changed

[1A[2K[info] AppState State updated {updates: Object}

[1A[2K[info] CharacterManager Character list loaded {count: 2}

[1A[2K[info] PageHandler Character list rendered {count: 2}

[1A[2K4. Navigating to Build page...

[1A[2K[info] NavigationController [2026-01-16T03:23:41.427Z] Navigate to page: "build"

[1A[2K[info] [Router] Navigating to {path: build}

[1A[2K[info] AppState Setting current page: build

[1A[2K[debug] AppState setState called {currentPage: build}

[1A[2K[debug] [EventBus] Event emitted {event: state:changed, argsCount: 2}

[1A[2K[debug] [EventBus] Event emitted {event: state:currentPage:changed, argsCount: 2}

[1A[2K[debug] AppState Emitted: state:currentPage:changed

[1A[2K[info] AppState State updated {updates: Object}

[1A[2K[debug] [EventBus] Event emitted {event: page:changed, argsCount: 1}

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[log] [TitlebarController] updateActionButtons called

[1A[2K[log] [TitlebarController] Character: {exists: true, name: adfasdfasdfa, hasProgression: true, progressionClasses: Array(1), classesLength: 1}

[1A[2K[log] [TitlebarController] Level Up Button: {hasClasses: true, disabled: false, characterExists: true}

[1A[2K[debug] NavigationController Handling page change {page: build}

[1A[2K[debug] AppInitializer [2026-01-16T03:23:41.428Z] EVENT: PAGE_CHANGED to "build"

[1A[2K[debug] AppInitializer Temporary suppression enabled until 2026-01-16T03:23:41.578Z

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[debug] AppInitializer Unsaved indicator updated: show=false {hasUnsaved: false, currentPage: build}

[1A[2K[debug] [EventBus] Event emitted {event: page:changed, argsCount: 1}

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[log] [TitlebarController] updateActionButtons called

[1A[2K[log] [TitlebarController] Character: {exists: true, name: adfasdfasdfa, hasProgression: true, progressionClasses: Array(1), classesLength: 1}

[1A[2K[log] [TitlebarController] Level Up Button: {hasClasses: true, disabled: false, characterExists: true}

[1A[2K[debug] NavigationController Handling page change {page: build}

[1A[2K[debug] AppInitializer [2026-01-16T03:23:41.429Z] EVENT: PAGE_CHANGED to "build"

[1A[2K[debug] AppInitializer Temporary suppression enabled until 2026-01-16T03:23:41.579Z

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[debug] AppInitializer Unsaved indicator updated: show=false {hasUnsaved: false, currentPage: build}

[1A[2K[info] [Router] Navigation successful {path: build}

[1A[2K[debug] NavigationController Set data-current-page attribute to "build" {page: build, attributeValue: build}

[1A[2K[debug] NavigationController [2026-01-16T03:23:41.429Z] Starting loadAndRenderPage: build

[1A[2K[info] PageLoader Load and render {templateName: build.html}

[1A[2K[debug] PageLoader Loading page {templateName: build.html}

[1A[2K[info] PageLoader Page loaded and cached {templateName: build.html}

[1A[2K[debug] PageLoader Page rendered successfully

[1A[2K[info] NavigationController [2026-01-16T03:23:41.434Z] Page rendered successfully: build {template: build.html, pageName: build}

[1A[2K[debug] NavigationController Page render complete: build

[1A[2K[debug] NavigationController Emitting PAGE_LOADED event for page: "build"

[1A[2K[debug] [EventBus] Event emitted {event: page:loaded, argsCount: 1}

[1A[2K[info] PageHandler Handling page loaded {pageName: build}

[1A[2K[debug] [EventBus] Listener removed {event: character:selected, remainingListeners: 5}

[1A[2K[debug] [EventBus] Listener removed {event: character:created, remainingListeners: 2}

[1A[2K[info] PageHandler Initializing build page

[1A[2K[debug] BackgroundService Already initialized

[1A[2K[debug] AbilityScoreCard abilityScoresChanged event received

[1A[2K[debug] [EventBus] Listener registered {event: sources:allowed-changed, totalListeners: 1}

[1A[2K[debug] [EventBus] Listener registered {event: character:selected, totalListeners: 6}

[1A[2K[debug] [EventBus] Listener registered {event: proficiency:added, totalListeners: 1}

[1A[2K[debug] [EventBus] Listener registered {event: proficiency:removedBySource, totalListeners: 1}

[1A[2K[debug] [EventBus] Listener registered {event: proficiency:refunded, totalListeners: 1}

[1A[2K[debug] [EventBus] Listener registered {event: proficiency:optionalSelected, totalListeners: 1}

[1A[2K[debug] [EventBus] Listener registered {event: proficiency:optionalDeselected, totalListeners: 1}

[1A[2K[debug] NavigationController Nav buttons updated {activePage: build}

[1A[2K[debug] NavigationController Emitting PAGE_CHANGED event for page: "build"

[1A[2K[debug] [EventBus] Event emitted {event: page:changed, argsCount: 1}

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[log] [TitlebarController] updateActionButtons called

[1A[2K[log] [TitlebarController] Character: {exists: true, name: adfasdfasdfa, hasProgression: true, progressionClasses: Array(1), classesLength: 1}

[1A[2K[log] [TitlebarController] Level Up Button: {hasClasses: true, disabled: false, characterExists: true}

[1A[2K[debug] NavigationController Handling page change {page: build}

[1A[2K[debug] AppInitializer [2026-01-16T03:23:41.440Z] EVENT: PAGE_CHANGED to "build"

[1A[2K[debug] AppInitializer Temporary suppression enabled until 2026-01-16T03:23:41.590Z

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[debug] AppInitializer Unsaved indicator updated: show=false {hasUnsaved: false, currentPage: build}

[1A[2K[debug] [EventBus] Listener registered {event: race:selected, totalListeners: 1}

[1A[2K[debug] [EventBus] Listener registered {event: subrace:selected, totalListeners: 1}

[1A[2K[debug] [EventBus] Listener registered {event: character:selected, totalListeners: 7}

[1A[2K[debug] [EventBus] Listener registered {event: sources:allowed-changed, totalListeners: 2}

[1A[2K[debug] [EventBus] Listener registered {event: class:selected, totalListeners: 1}

[1A[2K[debug] [EventBus] Listener registered {event: subclass:selected, totalListeners: 1}

[1A[2K[debug] [EventBus] Listener registered {event: character:updated, totalListeners: 3}

[1A[2K[debug] [EventBus] Listener registered {event: character:selected, totalListeners: 8}

[1A[2K[debug] [EventBus] Listener registered {event: sources:allowed-changed, totalListeners: 3}

[1A[2K[log] [ProficiencyCard] _computeInstrumentSlots() called

[1A[2K[log] [ProficiencyCard] Source race: options= [] allowed= 0

[1A[2K[log] [ProficiencyCard] Source race: selected= []

[1A[2K[log] [ProficiencyCard] Source race: offersInstruments=false, isExplicitlySelected=false

[1A[2K[log] [ProficiencyCard] Source race: isOnlyOption=false, shouldCreateSlots=false

[1A[2K[log] [ProficiencyCard] Source class: options= [] allowed= 0

[1A[2K[log] [ProficiencyCard] Source class: selected= []

[1A[2K[log] [ProficiencyCard] Source class: offersInstruments=false, isExplicitlySelected=false

[1A[2K[log] [ProficiencyCard] Source class: isOnlyOption=false, shouldCreateSlots=false

[1A[2K[log] [ProficiencyCard] Source background: options= [] allowed= 0

[1A[2K[log] [ProficiencyCard] Source background: selected= []

[1A[2K[log] [ProficiencyCard] Source background: offersInstruments=false, isExplicitlySelected=false

[1A[2K[log] [ProficiencyCard] Source background: isOnlyOption=false, shouldCreateSlots=false

[1A[2K[log] [ProficiencyCard] Rendering instrument choices with 0 slots: []

[1A[2K[debug] [EventBus] Listener registered {event: feats:selected, totalListeners: 1}

[1A[2K[debug] [EventBus] Listener registered {event: character:updated, totalListeners: 4}

[1A[2K[debug] [EventBus] Listener registered {event: character:selected, totalListeners: 9}

[1A[2K[info] PageHandler Build page cards initialized

[1A[2K[warning] [Renderer5etools] Unknown tag: 5etools

[1A[2K[error] ClassCard Error handling class change: TypeError: Cannot read properties of undefined (reading 'unpackUid')
    at ClassDetailsView._formatFeatureEntries (file:///C:/Users/K/Workbench/Dev/Electron/fizbanes-forge/src/ui/components/class/Card.js:1589:48)
    at async file:///C:/Users/K/Workbench/Dev/Electron/fizbanes-forge/src/ui/components/class/Card.js:1380:21
    at async Promise.all (index 3)
    at async ClassDetailsView.updateFeatures (file:///C:/Users/K/Workbench/Dev/Electron/fizbanes-forge/src/ui/components/class/Card.js:1366:30)
    at async ClassCard._updateFeatures (file:///C:/Users/K/Workbench/Dev/Electron/fizbanes-forge/src/ui/components/class/Card.js:471:3)
    at async ClassCard.updateClassDetails (file:///C:/Users/K/Workbench/Dev/Electron/fizbanes-forge/src/ui/components/class/Card.js:342:3)
    at async ClassCard._handleClassChange (file:///C:/Users/K/Workbench/Dev/Electron/fizbanes-forge/src/ui/components/class/Card.js:253:4)
    at async ClassCard._loadSavedClassSelection (file:///C:/Users/K/Workbench/Dev/Electron/fizbanes-forge/src/ui/components/class/Card.js:129:5)
    at async ClassCard.initialize (file:///C:/Users/K/Workbench/Dev/Electron/fizbanes-forge/src/ui/components/class/Card.js:54:4)

[1A[2K5. Checking initial save button state...

[1A[2K   Save button initially disabled: true

[1A[2K6. Opening Level Up modal...

[1A[2K[info] AppInitializer [LevelUp] Button clicked

[1A[2K[debug] AppInitializer [LevelUp] Importing LevelUpModal

[1A[2K[debug] [LevelUpModal] Constructor initialized

[1A[2K[debug] AppInitializer [LevelUp] Showing modal via controller

[1A[2K[info] [LevelUpModal] Opening for character adfasdfasdfa

[1A[2K[info] [LevelUpSession] Initialized for character {characterName: adfasdfasdfa, currentLevel: 5, classes: Sorcerer undefined}

[1A[2K[debug] [LevelUpModal] Button listeners attached

[1A[2K[debug] [LevelUpModal] Rendering step 0

[1A[2K[debug] [Step0] Attaching listeners

[1A[2K7. Adding 5 levels...

[1A[2K   Found 0 class(es) to level up

[1A[2K8. Navigating through wizard steps...

[1A[2K[debug] [LevelUpModal] Rendering step 1

[1A[2K   Step 1: Class Features

[1A[2K[debug] [LevelUpModal] Rendering step 2

[1A[2K   Step 2: ASI/Feat Selection

[1A[2K[debug] [LevelUpModal] Rendering step 3

[1A[2K   Step 3: Spell Selection

[1A[2K[debug] [LevelUpModal] Rendering step 4

[1A[2K[debug] [Step4] Attaching listeners

[1A[2K   Step 4: Summary

[1A[2K9. Confirming changes...

[1A[2K[info] [LevelUpModal] Confirming changes...

[1A[2K[info] [LevelUpSession] Applying staged changes to character

[1A[2K[debug] [LevelUpSession] HP recalculation would happen here

[1A[2K[info] [LevelUpService] Updated spell slots

[1A[2K[debug] [LevelUpSession] Spell slots recalculated for staged changes

[1A[2K[info] [LevelUpService] Updated spell slots

[1A[2K[info] [LevelUpService] Recorded level-up {fromLevel: 5, toLevel: 5, appliedFeats: Array(0), appliedFeatures: Array(0), changedAbilities: Object}

[1A[2K[info] [LevelUpSession] Changes applied successfully {newLevel: 5, fromLevel: 5, toLevel: 5, newClasses: Sorcerer undefined}

[1A[2K[log] [LevelUpModal.confirm] Character after applyChanges: {id: 8fa32a00-e0f9-49d0-b33c-1acddc57cd45, name: adfasdfasdfa, level: 5, progression: Object}

[1A[2K[info] AppState Setting current character {id: 8fa32a00-e0f9-49d0-b33c-1acddc57cd45, skipEvent: true}

[1A[2K[debug] AppState setState called {currentCharacter: Character}

[1A[2K[debug] [EventBus] Event emitted {event: state:changed, argsCount: 2}

[1A[2K[info] AppState State updated {updates: Object}

[1A[2K[log] [LevelUpModal.confirm] Character in AppState after set: {id: 8fa32a00-e0f9-49d0-b33c-1acddc57cd45, name: adfasdfasdfa, level: 5, progression: Object}

[1A[2K[debug] [EventBus] Event emitted {event: character:updated, argsCount: 1}

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[log] [TitlebarController] updateActionButtons called

[1A[2K[log] [TitlebarController] Character: {exists: true, name: adfasdfasdfa, hasProgression: true, progressionClasses: Array(1), classesLength: 1}

[1A[2K[log] [TitlebarController] Level Up Button: {hasClasses: true, disabled: false, characterExists: true}

[1A[2K[debug] AppInitializer [2026-01-16T03:23:47.724Z] EVENT: CHARACTER_UPDATED received

[1A[2K[info] AppState Unsaved changes: true

[1A[2K[debug] AppState setState called {hasUnsavedChanges: true}

[1A[2K[debug] [EventBus] Event emitted {event: state:changed, argsCount: 2}

[1A[2K[debug] [EventBus] Event emitted {event: state:hasUnsavedChanges:changed, argsCount: 2}

[1A[2K[debug] AppState Get: hasUnsavedChanges true

[1A[2K[debug] AppState Get: hasUnsavedChanges true

[1A[2K[log] [TitlebarController] updateActionButtons called

[1A[2K[log] [TitlebarController] Character: {exists: true, name: adfasdfasdfa, hasProgression: true, progressionClasses: Array(1), classesLength: 1}

[1A[2K[log] [TitlebarController] Level Up Button: {hasClasses: true, disabled: false, characterExists: true}

[1A[2K[debug] AppInitializer state:hasUnsavedChanges:changed -> true

[1A[2K[debug] AppState Get: hasUnsavedChanges true

[1A[2K[debug] AppInitializer Unsaved indicator updated: show=true {hasUnsaved: true, currentPage: build}

[1A[2K[debug] AppState Emitted: state:hasUnsavedChanges:changed

[1A[2K[info] AppState State updated {updates: Object}

[1A[2K[debug] AppState Get: hasUnsavedChanges true

[1A[2K[debug] AppInitializer Unsaved indicator updated: show=true {hasUnsaved: true, currentPage: build}

[1A[2K[debug] [EventBus] Event emitted {event: LEVEL_UP_COMPLETE, argsCount: 1}

[1A[2K[info] [LevelUpModal] Changes applied and modal closed

[1A[2K[warning] [Renderer5etools] Unknown tag: 5etools

[1A[2K[debug] [LevelUpModal] Modal hidden

[1A[2K[debug] [DOMCleanup] Cleanup complete {listenersRemoved: 5, timersCleared: 0, modalsDisposed: 1}

[1A[2K10. Checking CHARACTER_UPDATED event...

[1A[2K   CHARACTER_UPDATED events: 1

[1A[2K   - AppInitializer [2026-01-16T03:23:47.724Z] EVENT: CHARACTER_UPDATED received

[1A[2K11. Checking save button state after level-up...

[1A[2K   Save button disabled after level-up: false

[1A[2K   Save button has 'unsaved' class: true

[1A[2K   AppState: {}

[1A[2K12. Attempting to click save button...

[1A[2K   Ã”Â£Ã´ Save button is enabled, clicking it...

[1A[2K[info] AppInitializer [2026-01-16T03:23:49.781Z] Save button clicked

[1A[2K[info] CharacterManager Saving character {id: 8fa32a00-e0f9-49d0-b33c-1acddc57cd45, name: adfasdfasdfa, level: 5, progression: Object}

[1A[2K[debug] CharacterSchema Character touched {id: 8fa32a00-e0f9-49d0-b33c-1acddc57cd45}

[1A[2K[debug] CharacterSchema Validation passed {characterId: 8fa32a00-e0f9-49d0-b33c-1acddc57cd45}

[1A[2K[log] [Character.toJSON] Called - optionalProficiencies.tools.class BEFORE serialization: {"allowed":0,"options":[],"selected":[]}

[1A[2K[log] [Character.toJSON] Serialized optionalProficiencies.tools.class: {"allowed":0,"options":[],"selected":[]}

[1A[2K[log] [CharacterManager.saveCharacter] Serialized character: {id: 8fa32a00-e0f9-49d0-b33c-1acddc57cd45, name: adfasdfasdfa, level: 5, progression: Object}

[1A[2K[info] AppState Unsaved changes: false

[1A[2K[debug] AppState setState called {hasUnsavedChanges: false}

[1A[2K[debug] [EventBus] Event emitted {event: state:changed, argsCount: 2}

[1A[2K[debug] [EventBus] Event emitted {event: state:hasUnsavedChanges:changed, argsCount: 2}

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[log] [TitlebarController] updateActionButtons called

[1A[2K[log] [TitlebarController] Character: {exists: true, name: adfasdfasdfa, hasProgression: true, progressionClasses: Array(1), classesLength: 1}

[1A[2K[log] [TitlebarController] Level Up Button: {hasClasses: true, disabled: false, characterExists: true}

[1A[2K[debug] AppInitializer state:hasUnsavedChanges:changed -> false

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[debug] AppInitializer Unsaved indicator updated: show=false {hasUnsaved: false, currentPage: build}

[1A[2K[debug] AppState Emitted: state:hasUnsavedChanges:changed

[1A[2K[info] AppState State updated {updates: Object}

[1A[2K[debug] [EventBus] Event emitted {event: character:saved, argsCount: 1}

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[log] [TitlebarController] updateActionButtons called

[1A[2K[log] [TitlebarController] Character: {exists: true, name: adfasdfasdfa, hasProgression: true, progressionClasses: Array(1), classesLength: 1}

[1A[2K[log] [TitlebarController] Level Up Button: {hasClasses: true, disabled: false, characterExists: true}

[1A[2K[debug] AppInitializer [2026-01-16T03:23:49.791Z] EVENT: CHARACTER_SAVED received

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[debug] AppInitializer Unsaved indicator updated: show=false {hasUnsaved: false, currentPage: build}

[1A[2K[info] CharacterManager Character saved {id: 8fa32a00-e0f9-49d0-b33c-1acddc57cd45}

[1A[2K[info] AppInitializer Character saved successfully

[1A[2K[debug] AppInitializer Emitting CHARACTER_SAVED event

[1A[2K[debug] [EventBus] Event emitted {event: character:saved, argsCount: 0}

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[log] [TitlebarController] updateActionButtons called

[1A[2K[log] [TitlebarController] Character: {exists: true, name: adfasdfasdfa, hasProgression: true, progressionClasses: Array(1), classesLength: 1}

[1A[2K[log] [TitlebarController] Level Up Button: {hasClasses: true, disabled: false, characterExists: true}

[1A[2K[debug] AppInitializer [2026-01-16T03:23:49.792Z] EVENT: CHARACTER_SAVED received

[1A[2K[debug] AppState Get: hasUnsavedChanges false

[1A[2K[debug] AppInitializer Unsaved indicator updated: show=false {hasUnsaved: false, currentPage: build}

[1A[2K
=== TEST RESULTS (First Launch) ===

[1A[2KInitial character level: 1

[1A[2KLevels added: 5

[1A[2KSave button disabled after level-up: false

[1A[2KUnsaved indicator (unsaved class): true

[1A[2KHas unsaved changes: undefined

[1A[2KCharacter level: undefined

[1A[2KTotal errors: 1

[1A[2K
Errors encountered:

[1A[2K1. ClassCard Error handling class change: TypeError: Cannot read properties of undefined (reading 'unpackUid')
    at ClassDetailsView._formatFeatureEntries (file:///C:/Users/K/Workbench/Dev/Electron/fizbanes-forge/src/ui/components/class/Card.js:1589:48)
    at async file:///C:/Users/K/Workbench/Dev/Electron/fizbanes-forge/src/ui/components/class/Card.js:1380:21
    at async Promise.all (index 3)
    at async ClassDetailsView.updateFeatures (file:///C:/Users/K/Workbench/Dev/Electron/fizbanes-forge/src/ui/components/class/Card.js:1366:30)
    at async ClassCard._updateFeatures (file:///C:/Users/K/Workbench/Dev/Electron/fizbanes-forge/src/ui/components/class/Card.js:471:3)
    at async ClassCard.updateClassDetails (file:///C:/Users/K/Workbench/Dev/Electron/fizbanes-forge/src/ui/components/class/Card.js:342:3)
    at async ClassCard._handleClassChange (file:///C:/Users/K/Workbench/Dev/Electron/fizbanes-forge/src/ui/components/class/Card.js:253:4)
    at async ClassCard._loadSavedClassSelection (file:///C:/Users/K/Workbench/Dev/Electron/fizbanes-forge/src/ui/components/class/Card.js:129:5)
    at async ClassCard.initialize (file:///C:/Users/K/Workbench/Dev/Electron/fizbanes-forge/src/ui/components/class/Card.js:54:4)

[1A[2K
13. Closing app to test persistence...

[1A[2K[2/2] tests\level-up-save-button.spec.js:225:3 Ã”Ã‡â•‘ Level Up Save Button Ã”Ã‡â•‘ should show increased level after app relaunch
[1A[2Ktests\level-up-save-button.spec.js:225:3 Ã”Ã‡â•‘ Level Up Save Button Ã”Ã‡â•‘ should show increased level after app relaunch

=== SECOND LAUNCH: Verifying Persistence ===

[1A[2K1. Waiting for app to load...

[1A[2K2. Checking character level on home page...

[1A[2K   Character level after relaunch: 1

[1A[2K
=== TEST RESULTS (Second Launch) ===

[1A[2KCharacter level: 1

[1A[2KCharacter is loadable: true

[1A[2KÃ”Â£Ã´ Character persisted correctly!

[1A[2K
3. Closing app...

[1A[2K  2 passed (17.9s)
